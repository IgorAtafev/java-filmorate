DROP TABLE IF EXISTS mpa CASCADE;
DROP TABLE IF EXISTS films CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS user_friends CASCADE;
DROP TABLE IF EXISTS film_likes CASCADE;
DROP TABLE IF EXISTS genres CASCADE;
DROP TABLE IF EXISTS film_genres CASCADE;

CREATE TABLE IF NOT EXISTS mpa (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar(10) NOT NULL
);

CREATE TABLE IF NOT EXISTS films (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar(100) NOT NULL,
  description varchar(200) NOT NULL,
  release_date date NOT NULL,
  duration int NOT NULL,
  mpa_id int NOT NULL REFERENCES mpa (id)
);

CREATE TABLE IF NOT EXISTS users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  email varchar(50) NOT NULL,
  login varchar(50) NOT NULL,
  name varchar(50) NOT NULL,
  birth_day date NOT NULL
);

CREATE TABLE IF NOT EXISTS user_friends (
  user_id bigint REFERENCES users (id) ON DELETE CASCADE ON UPDATE RESTRICT,
  friend_id bigint REFERENCES users (id) ON DELETE CASCADE ON UPDATE RESTRICT,
  is_confirmed boolean NOT NULL DEFAULT FALSE,
  PRIMARY KEY (user_id, friend_id)
);

CREATE TABLE IF NOT EXISTS film_likes (
  film_id bigint REFERENCES films (id) ON DELETE CASCADE ON UPDATE RESTRICT,
  user_id bigint REFERENCES users (id) ON DELETE CASCADE ON UPDATE RESTRICT,
  PRIMARY KEY (film_id, user_id)
);

CREATE TABLE IF NOT EXISTS genres (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS film_genres (
  film_id bigint REFERENCES films (id) ON DELETE CASCADE ON UPDATE RESTRICT,
  genre_id int REFERENCES genres (id) ON DELETE CASCADE ON UPDATE RESTRICT,
  PRIMARY KEY (film_id, genre_id)
);