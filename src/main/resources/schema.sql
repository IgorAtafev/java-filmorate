CREATE TABLE IF NOT EXISTS mpa (
  id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar(10) NOT NULL
);

CREATE TABLE IF NOT EXISTS films (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar(100) NOT NULL,
  description varchar(200) NOT NULL,
  release_date date NOT NULL,
  duration int NOT NULL,
  mpa_id int NOT NULL REFERENCES mpa (id)
);

CREATE TABLE IF NOT EXISTS users (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  email varchar(50) NOT NULL,
  login varchar(50) NOT NULL,
  name varchar(50) NOT NULL,
  birth_day date NOT NULL
);

CREATE TABLE IF NOT EXISTS user_friends (
  user_id bigint NOT NULL REFERENCES users (id) ON DELETE RESTRICT ON UPDATE RESTRICT,
  friend_id bigint NOT NULL REFERENCES users (id) ON DELETE RESTRICT ON UPDATE RESTRICT,
  PRIMARY KEY (user_id, friend_id)
);

CREATE TABLE IF NOT EXISTS film_likes (
  film_id bigint NOT NULL REFERENCES films (id) ON DELETE RESTRICT ON UPDATE RESTRICT,
  user_id bigint NOT NULL REFERENCES users (id) ON DELETE RESTRICT ON UPDATE RESTRICT,
  PRIMARY KEY (film_id, user_id)
);

CREATE TABLE IF NOT EXISTS genres (
  id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS film_genres (
  film_id bigint NOT NULL REFERENCES films (id) ON DELETE RESTRICT ON UPDATE RESTRICT,
  genre_id int NOT NULL REFERENCES genres (id) ON DELETE RESTRICT ON UPDATE RESTRICT,
  PRIMARY KEY (film_id, genre_id)
);

CREATE TABLE IF NOT EXISTS event_types (
  id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  event_type_name varchar(10) NOT NULL
);

CREATE TABLE IF NOT EXISTS operations (
  id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  operation_name varchar(10) NOT NULL
);

CREATE TABLE IF NOT EXISTS events (
  event_id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  timestamp BIGINT NOT NULL,
  user_id BIGINT NOT NULL REFERENCES users (id),
  event_type INT NOT NULL REFERENCES event_types (id),
  operation INT NOT NULL REFERENCES operations (id),
  entity_id BIGINT NOT NULL
);